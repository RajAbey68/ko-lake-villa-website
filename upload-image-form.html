<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ko Lake Villa - Gallery Image Uploader</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f9f9f9;
    }
    h1, h2, h3 {
      color: #8B5E3C;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e1e1e1;
    }
    .upload-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    label {
      font-weight: 600;
      margin-bottom: 5px;
      display: block;
    }
    select, input, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    textarea {
      min-height: 100px;
    }
    .file-input {
      margin: 10px 0;
    }
    .button {
      background-color: #8B5E3C;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    .button:hover {
      background-color: #A0B985;
    }
    .preview-container {
      margin-top: 20px;
    }
    .image-preview {
      max-width: 300px;
      max-height: 200px;
      border: 1px solid #ddd;
      border-radius: 4px;
      display: none;
      margin-top: 10px;
    }
    .success-message {
      color: #4CAF50;
      font-weight: bold;
      display: none;
      margin-top: 10px;
    }
    .error-message {
      color: #F44336;
      font-weight: bold;
      display: none;
      margin-top: 10px;
    }
    .categories {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .category-card {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .category-name {
      background: #8B5E3C;
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }
    .category-image {
      height: 150px;
      background-color: #f1f1f1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .category-image img {
      max-width: 100%;
      max-height: 150px;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Ko Lake Villa - Gallery Image Uploader</h1>
  </div>
  
  <div class="upload-container">
    <h2>Upload New Image</h2>
    <form id="uploadForm" enctype="multipart/form-data">
      <div>
        <label for="category">Category:</label>
        <select id="category" name="category" required>
          <option value="">Select a category</option>
          <option value="family-suite">Family Suite</option>
          <option value="group-room">Group Room</option>
          <option value="triple-room">Triple Room</option>
          <option value="dining-area">Dining Area</option>
          <option value="pool-deck">Pool Deck</option>
          <option value="lake-garden">Lake Garden</option>
          <option value="roof-garden">Roof Garden</option>
          <option value="front-garden">Front Garden and Entrance</option>
          <option value="koggala-lake">Koggala Lake Ahangama and Surrounding</option>
          <option value="excursions">Excursions</option>
        </select>
      </div>
      
      <div>
        <label for="alt">Image Title/Alt Text:</label>
        <input type="text" id="alt" name="alt" required placeholder="Provide a descriptive title for the image">
      </div>

      <div>
        <label for="description">Description (optional):</label>
        <textarea id="description" name="description" placeholder="Add a detailed description of the image"></textarea>
      </div>
      
      <div>
        <label for="featured">Featured Image?</label>
        <select id="featured" name="featured">
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select>
      </div>
      
      <div>
        <label for="sortOrder">Sort Order:</label>
        <input type="number" id="sortOrder" name="sortOrder" min="1" value="1" required>
      </div>
      
      <div class="file-input">
        <label for="image">Select Image:</label>
        <input type="file" id="image" name="image" accept="image/*" required>
      </div>
      
      <div class="preview-container">
        <img id="imagePreview" class="image-preview">
      </div>
      
      <button type="submit" class="button">Upload Image</button>
      
      <div id="successMessage" class="success-message">Image uploaded successfully!</div>
      <div id="errorMessage" class="error-message"></div>
    </form>
  </div>
  
  <h2>Category Overview</h2>
  <div class="categories">
    <div class="category-card">
      <div class="category-name">Family Suite</div>
      <div class="category-image">
        <img id="family-suite-img" src="/uploads/gallery/family-suite/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Family Suite">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Group Room</div>
      <div class="category-image">
        <img id="group-room-img" src="/uploads/gallery/group-room/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Group Room">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Triple Room</div>
      <div class="category-image">
        <img id="triple-room-img" src="/uploads/gallery/triple-room/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Triple Room">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Dining Area</div>
      <div class="category-image">
        <img id="dining-area-img" src="/uploads/gallery/dining-area/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Dining Area">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Pool Deck</div>
      <div class="category-image">
        <img id="pool-deck-img" src="/uploads/gallery/pool-deck/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Pool Deck">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Lake Garden</div>
      <div class="category-image">
        <img id="lake-garden-img" src="/uploads/gallery/lake-garden/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Lake Garden">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Roof Garden</div>
      <div class="category-image">
        <img id="roof-garden-img" src="/uploads/gallery/roof-garden/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Roof Garden">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Front Garden</div>
      <div class="category-image">
        <img id="front-garden-img" src="/uploads/gallery/front-garden/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Front Garden">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Koggala Lake</div>
      <div class="category-image">
        <img id="koggala-lake-img" src="/uploads/gallery/koggala-lake/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Koggala Lake">
      </div>
    </div>
    
    <div class="category-card">
      <div class="category-name">Excursions</div>
      <div class="category-image">
        <img id="excursions-img" src="/uploads/gallery/excursions/placeholder.jpg" onerror="this.src='/uploads/gallery/placeholder.jpg'" alt="Excursions">
      </div>
    </div>
  </div>

  <script>
    // Preview the image when selected
    document.getElementById('image').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('imagePreview');
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
      } else {
        preview.style.display = 'none';
      }
    });
    
    // Handle form submission
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const successMessage = document.getElementById('successMessage');
      const errorMessage = document.getElementById('errorMessage');
      
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      
      const formData = new FormData(this);
      
      try {
        const response = await fetch('/api/gallery/upload', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (response.ok) {
          // Show success message
          successMessage.textContent = 'Image uploaded successfully!';
          successMessage.style.display = 'block';
          
          // Reset form
          this.reset();
          document.getElementById('imagePreview').style.display = 'none';
          
          // Update the category card with the new image
          const category = result.data.category;
          const imageUrl = result.data.imageUrl;
          document.getElementById(`${category}-img`).src = imageUrl;
          
          // Load the latest gallery images to refresh the category cards
          loadCategoryImages();
        } else {
          errorMessage.textContent = result.message || 'Failed to upload image. Please try again.';
          errorMessage.style.display = 'block';
        }
      } catch (error) {
        console.error('Error uploading image:', error);
        errorMessage.textContent = 'An unexpected error occurred. Please try again.';
        errorMessage.style.display = 'block';
      }
    });
    
    // Function to load the most recent image for each category
    async function loadCategoryImages() {
      try {
        const response = await fetch('/api/gallery');
        if (!response.ok) {
          throw new Error('Failed to fetch gallery images');
        }
        
        const images = await response.json();
        
        // Group images by category
        const categorizedImages = {};
        images.forEach(image => {
          if (!categorizedImages[image.category]) {
            categorizedImages[image.category] = [];
          }
          categorizedImages[image.category].push(image);
        });
        
        // Update each category with the most recent image
        Object.keys(categorizedImages).forEach(category => {
          // Sort images by ID (most recent first)
          const sorted = categorizedImages[category].sort((a, b) => b.id - a.id);
          if (sorted.length > 0) {
            const categoryElement = document.getElementById(`${category}-img`);
            if (categoryElement) {
              categoryElement.src = sorted[0].imageUrl;
            }
          }
        });
      } catch (error) {
        console.error('Error loading gallery images:', error);
      }
    }
    
    // Load category images when the page loads
    window.addEventListener('load', loadCategoryImages);
  </script>
</body>
</html>